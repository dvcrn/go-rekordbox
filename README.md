<div align="center">
    <img src="./logo.png" width="300"/>
</div>

# Golang wrapper for rekordbox databases

This is a wrapper to query and interact with the rekordbox 6 database

Motivation behind this tool is to enable better automation and integration with rekordbox. In previous versions it was possible to just use the rekordbox XML to query data, but since rekordbox 6 this is no longer possible

**Note**: This is a quickly hacked together project. Use at own risk, and make a backup of your database.

## What is this exactly?

This wrapper is mostly automatically generated by connecting to the rekordbox database and using it's schema to create a bunch of models including helper functions around SQL commands. You can find those in `rekordbox/`, and the dumped schema in `db/schema.sql`

Docs are available at https://pkg.go.dev/github.com/dvcrn/go-rekordbox/rekordbox

## Install

```
go get github.com/dvcrn/go-rekordbox
```

## Usage Example: Query all playlists

Create a new `rekordbox.Client` with `rekordbox.NewClient` and use it to query

You'll need 2 file pathes:

- path to `options.json`, on mac this is typically `~/Library/Application Support/Pioneer/rekordboxAgent/storage/options.json`, on windows potentially in `C:\Users\XXXX\AppData\Roaming\Pioneer\rekordboxAgent\storage`
- path to the `app.asar` file that's bundled with rekordbox, on mac this is `/Applications/rekordbox 6/rekordbox.app/Contents/MacOS/rekordboxAgent.app/Contents/Resources/app.asar`, on windows potentially in `C:\Users\XXXX\AppData\Roaming\Pioneer\rekordboxAgent\storage`

```golang
package main

import (
	"context"
	"fmt"

	"github.com/dvcrn/go-rekordbox/rekordbox"
)

func main() {
	ctx := context.Background()

	homeDir, err := os.UserHomeDir()
	if err != nil {
		panic(err)
	}

	optionsFilePath := filepath.Join(homeDir, "/Library/Application Support/Pioneer/rekordboxAgent/storage/", "options.json")

	asarPath := "/Applications/rekordbox 6/rekordbox.app/Contents/MacOS/rekordboxAgent.app/Contents/Resources/app.asar"

	client, err := rekordbox.NewClient(optionsFilePath, asarPath)
	if err != nil {
		panic(err)
	}
	defer client.Close()

    // query all playlists
	playlists, err := client.AllDjmdPlaylist(ctx)
	if err != nil {
		panic(err)
	}

	for _, playlist := range playlists {
		fmt.Printf("%s\n", playlist.Name.String)

        // query all songs that are in the playlist
		playlistSongs, err := client.DjmdSongPlaylistByPlaylistID(ctx, playlist.ID)
		if err != nil {
			panic(err)
		}

        // get all songs within the playlist
		for _, playlistSong := range playlistSongs {
			content, err := client.DjmdContentByID(ctx, playlistSong.ContentID)
			if err != nil {
				panic(err)
			}

			fmt.Printf("\t%s\n", content.Title.String)
		}
	}
}
```

Output:

```
Tech
        8A - 125 - La Candela Viva (Extended Mix)
        10A - 125 - Do It To It (Extended Mix)
        8B - 125 - Milk Shake (Original Mix)
        6A - 126 - You Give Me A Feeling (Original Mix)
        12B - 129 - My Humps (Original Mix)
        4A - 126 - Want To Love (Extended Mix)
        12B - 126 - Technologic (Original Mix)
        9B - 126 - Disconnected (Extended Mix)
        (...and so on)
```

## How to regenerate the models (after rekordbox upgrades)

There's a handy Makefile command that does all of this for you:

```
make genmodels
```

## Prior art

- Initial database connection code taken from [supbox](https://github.com/gabek/supbox)
